<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>occOutlierR: Identifying outlying species occurrence records • occOutliers</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="occOutlierR: Identifying outlying species occurrence records">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">occOutliers</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/occOutlier.html">occOutlierR: Identifying outlying species occurrence records</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>occOutlierR: Identifying outlying species occurrence records</h1>
                        <h4 data-toc-skip class="author">Cory Merow,
Gonzalo E. Pinilla-Buitrago</h4>
            
            <h4 data-toc-skip class="date">2024-09-09</h4>
      

      <div class="d-none name"><code>occOutlier.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="outlier-detection-in-species-distribution-modeling">Outlier Detection in Species Distribution Modeling<a class="anchor" aria-label="anchor" href="#outlier-detection-in-species-distribution-modeling"></a>
</h2>
<p>Species distribution models (SDMs) are widely used in ecology to
predict the potential distribution of species across different
environments. However, building accurate SDMs can be challenging due to
the presence of outliers in occurrence data. Outliers are records that
deviate significantly from other observations and can have a substantial
impact on model predictions.</p>
<p>The difficulty of detecting outliers lies in their unpredictability.
They can arise from measurement errors, sampling processes, or skewed
distributions. Small sample sizes exacerbate this issue, making it
challenging to identify outliers using traditional descriptive
statistics such as boxplots and percentiles. Furthermore, the presence
of disjunct clusters of outlying records (known as “masked outliers”)
can make detection even more difficult.</p>
<p>In this vignette, we will show several approaches for identifying and
dealing with these issues by examining various methods for detecting
outliers spatial and environmental outliers. The goal is to provide a
comprehensive overview on how to effectively address these issues using
adaptable outlier detection methods.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gepinillab.github.io/occOutliers/">occOutliers</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="detection-of-outliers">Detection of outliers<a class="anchor" aria-label="anchor" href="#detection-of-outliers"></a>
</h2>
<p>Outliers are identified based on their distance from other
observations in either geographic or environmental space. A multivariate
distance metrics, such as Euclidean distance, are used to measure the
distance between each record and the centroid of all observations.
One-tailed tests for outlier detection are designed to detect
exceedingly large distances which are practical for automation in
modeling pipelines.</p>
<div class="section level3">
<h3 id="spatial">Spatial<a class="anchor" aria-label="anchor" href="#spatial"></a>
</h3>
<p>To calculate spatial outliers, we need to use a method that takes
into account the spatial relationships between observations. This can be
achieved by calculating the distances between each observation and the
centroid of all observations. We require an <code>sf</code> object with
a defined Coordinate Reference System (CRS) for this calculation. If the
CRS is projected, we will use Euclidean distance as a measure of
distance. However, if the CRS is geographic, we will use Great Circle
distance to account for the curvature of the Earth. The
<code>occOutlier</code> package uses <code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">sf::st_distance()</a></code>
internally to perform these calculations, which provides a convenient
interface for working with spatial data in R.</p>
<p>In these vignette’s examples, we will use species geographic
coordinates (WGS84). Each CSV file contain the coordinates of each
observation (‘X’ and ‘Y’), plus more columns with environmental data
which will be use in upcoming examples. For this first example, we will
use <em>Astraea macroura</em> to detect spatial outliers.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a_macroura</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/Astraea_macroura.csv'</span>,</span>
<span>                                   package <span class="op">=</span> <span class="st">'occOutliers'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Set WGS84</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_set_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">a_macroura</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="occOutlier_files/figure-html/unnamed-chunk-1-1.png" width="80%"></p>
<p>´occOutlier´ offers four methods to detect outlier based on their
distance to the centroid.</p>
<ul>
<li>‘iqr’: Interquartile range</li>
<li>‘grubbs’: The Grubb’s outlier test</li>
<li>‘dixon’: The Dixon’s outlier test</li>
<li>‘rosner’: The Rosner test for multiple outliers</li>
</ul>
<div class="section level4">
<h4 id="interquartile-range-iqr">Interquartile range (IQR)<a class="anchor" aria-label="anchor" href="#interquartile-range-iqr"></a>
</h4>
<p>The IQR method calculates the difference between the 75th percentile
(Q3) and the 25th percentile (Q1). Data points more than 1.5 times this
range away from Q1 or Q3 are typically considered outliers. This simple
yet effective approach helps identify data points that significantly
deviate from the rest of the dataset, making it a useful tool in outlier
detection.</p>
<p>The main function of the package is <code><a href="../reference/findOutliers.html">findOutliers()</a></code>. The
main input is a <code>sf</code> object with coordinates. Then, you can
define if you want to detect spatial or environmental outliers with
their respective parameters (both TRUE as default). And finally you can
define the method to detect outliers with the ‘method’ parameter. Here,
we will use ‘iqr’.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_iqr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findOutliers.html">findOutliers</a></span><span class="op">(</span><span class="va">a_macroura</span>, environmental <span class="op">=</span> <span class="cn">FALSE</span>, method <span class="op">=</span> <span class="st">"iqr"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2 geographic outlier(s) found with method iqr"</span></span></code></pre>
<p>As you notice for the message, two outliers were detected using this
method. The output of the function is the same object with an additional
column (out_spatial), that allow you to know which are the outliers.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_iqr</span><span class="op">$</span><span class="va">out_spatial</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE</span></span>
<span><span class="co">## [13] FALSE FALSE FALSE FALSE  TRUE</span></span></code></pre>
<p>To visualize, you can plot the points using plot() function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sp_iqr</span><span class="op">[</span><span class="st">"out_spatial"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="occOutlier_files/figure-html/unnamed-chunk-2-1.png" width="80%"></p>
<p>This package also provide the <code>plotOutlier</code> function to
easy visualize the result by adding a shapefile.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load world shapefile</span></span>
<span><span class="va">worldWGS84</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/worldWGS84.rds'</span>,</span>
<span>                                  package <span class="op">=</span> <span class="st">'occOutliers'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Get outlier plot</span></span>
<span><span class="fu"><a href="../reference/plotOutliers.html">plotOutliers</a></span><span class="op">(</span><span class="va">sp_iqr</span>, shpToPlot <span class="op">=</span> <span class="va">worldWGS84</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">## all geometries</span></span></code></pre>
<p><img src="occOutlier_files/figure-html/plotOut-1.png" width="80%"></p>
<p>As a tip, keep in mind that the plotOutlier() function has two useful
parameters that allow you to expand the shapefile buffer around
coordinates (bufferDist), and change the legend position (legLoc).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotOutliers.html">plotOutliers</a></span><span class="op">(</span><span class="va">sp_iqr</span>, legLoc <span class="op">=</span> <span class="st">"bottomright"</span>, bufferDist <span class="op">=</span> <span class="fl">0.4</span>, </span>
<span>             shpToPlot <span class="op">=</span> <span class="va">worldWGS84</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">## all geometries</span></span></code></pre>
<p><img src="occOutlier_files/figure-html/plotOutMore-1.png" width="80%"></p>
</div>
<div class="section level4">
<h4 id="the-grubbs-outlier-test">The Grubb’s outlier test<a class="anchor" aria-label="anchor" href="#the-grubbs-outlier-test"></a>
</h4>
<p>The Grubbs test is a statistical method used to detect outliers in a
dataset. It calculates the distance between each data point and the mean
of the remaining data points, then determines which data points are
farthest away from the mean. This test is useful when there are multiple
outliers in the dataset or when the data distribution is skewed. This
test is the default method for <code>findOutlier()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_grubbs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findOutliers.html">findOutliers</a></span><span class="op">(</span><span class="va">a_macroura</span>, environmental <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "1 geographic outlier(s) found with method grubbs"</span></span></code></pre>
<p>Here, it was just detected one spatial outlier.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotOutliers.html">plotOutliers</a></span><span class="op">(</span><span class="va">sp_grubbs</span>, shpToPlot <span class="op">=</span> <span class="va">worldWGS84</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">## all geometries</span></span></code></pre>
<p><img src="occOutlier_files/figure-html/sp_grubbs_plot-1.png" width="80%"></p>
</div>
<div class="section level4">
<h4 id="the-dixons-outlier-test">The Dixon’s outlier test<a class="anchor" aria-label="anchor" href="#the-dixons-outlier-test"></a>
</h4>
<p>Dixon’s test is a statistical method used to detect single outliers
in a dataset. It calculates the difference between the largest and
smallest values, then compares this range to a critical value from a
standard normal distribution. This test assumes that there are no
multiple outliers, so it may not be suitable for datasets with complex
outlier patterns.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_dixon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findOutliers.html">findOutliers</a></span><span class="op">(</span><span class="va">a_macroura</span>, method <span class="op">=</span> <span class="st">"dixon"</span>, environmental <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "1 geographic outlier(s) found with method dixon"</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotOutliers.html">plotOutliers</a></span><span class="op">(</span><span class="va">sp_dixon</span>, shpToPlot <span class="op">=</span> <span class="va">worldWGS84</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">## all geometries</span></span></code></pre>
<p><img src="occOutlier_files/figure-html/sp_dixon_plot-1.png" width="80%"></p>
</div>
<div class="section level4">
<h4 id="rosners-test">Rosner’s Test<a class="anchor" aria-label="anchor" href="#rosners-test"></a>
</h4>
<p>Rosner’s test is a statistical method that detects single or multiple
outliers in a dataset by calculating the modified Z-score of each data
point. It provides an effective way to identify anomalies in datasets
with large sample sizes or complex distributions, while being robust
against non-normality and heavy-tailed distributions. This test requires
that you define the number of outliers to test (parameter ‘kRosner’)</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_rosner</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findOutliers.html">findOutliers</a></span><span class="op">(</span><span class="va">a_macroura</span>, method <span class="op">=</span> <span class="st">"rosner"</span>, kRosner <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                          environmental <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "2 geographic outlier(s) found with method rosner"</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotOutliers.html">plotOutliers</a></span><span class="op">(</span><span class="va">sp_rosner</span>, shpToPlot <span class="op">=</span> <span class="va">worldWGS84</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">## all geometries</span></span></code></pre>
<p><img src="occOutlier_files/figure-html/sp_rosner_plot-1.png" width="80%"></p>
<p>Keep in mind that you also can change the <em>p-value</em> for
assessing the significant of the test for ‘grubbs’, ‘dixon’, and
‘rosner’. Default is 1e-05. If we change to a smaller pval in the
previous test, no outliers will be detected.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findOutliers.html">findOutliers</a></span><span class="op">(</span><span class="va">a_macroura</span>, method <span class="op">=</span> <span class="st">"rosner"</span>, kRosner <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                          environmental <span class="op">=</span> <span class="cn">FALSE</span>, pval <span class="op">=</span> <span class="fl">1e-06</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "0 geographic outlier(s) found with method rosner"</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotOutliers.html">plotOutliers</a></span><span class="op">(</span><span class="va">sp_pval</span>, shpToPlot <span class="op">=</span> <span class="va">worldWGS84</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">## all geometries</span></span></code></pre>
<p><img src="occOutlier_files/figure-html/sp_rosner_pval-1.png" width="80%"></p>
</div>
</div>
<div class="section level3">
<h3 id="environmental-outliers">Environmental outliers<a class="anchor" aria-label="anchor" href="#environmental-outliers"></a>
</h3>
<p>Similar to the process of finding spatial outliers, you can use the
same four methods to find environmental outliers. However, for this
process you will also be able to select several ways to measure the
distance between the centroid and the observations (‘distEnvMethod’
parameter), and if you which to scale data (‘scaleData’; default is
TRUE). The output will be an <code>sf</code> object with a new column
‘out_env’.</p>
<p>For this example, we will use <em>Anarthria scabra</em> using
Scrubb´s test but changing the method to measure distance bewteen
centroids.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">A_scraba</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/Anarthria_scabra.csv'</span>,</span>
<span>                                   package <span class="op">=</span> <span class="st">'occOutliers'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Set WGS84</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_set_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">A_scraba</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="occOutlier_files/figure-html/A_scraba-1.png" width="80%"></p>
<div class="section level4">
<h4 id="euclidean-distance">Euclidean distance<a class="anchor" aria-label="anchor" href="#euclidean-distance"></a>
</h4>
<p>The Euclidean distance is a measure of the straight-line distance
between two points in n-dimensional space, calculated as the square root
of the sum of squared differences between corresponding coordinates.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e_euclidean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findOutliers.html">findOutliers</a></span><span class="op">(</span><span class="va">A_scraba</span>, spatial <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "1 environmental outlier(s) found with methods grubbs and euclidean (distance)."</span></span></code></pre>
<p>Here, one environmental outlier is detected, which correpons to the
northern observation.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotOutliers.html">plotOutliers</a></span><span class="op">(</span><span class="va">e_euclidean</span>, shpToPlot <span class="op">=</span> <span class="va">worldWGS84</span>, legLoc <span class="op">=</span> <span class="st">"topright"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">## all geometries</span></span></code></pre>
<p><img src="occOutlier_files/figure-html/e_euc_plot-1.png" width="80%"></p>
</div>
<div class="section level4">
<h4 id="manhattan-distance">Manhattan distance<a class="anchor" aria-label="anchor" href="#manhattan-distance"></a>
</h4>
<p>The Manhattan distance (also known as L1 distance) is a measure of
the sum of absolute differences between corresponding coordinates of two
points in n-dimensional space. It’s named after the grid layout of New
York City streets.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e_manhattan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findOutliers.html">findOutliers</a></span><span class="op">(</span><span class="va">A_scraba</span>, spatial <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                            distEnvMethod <span class="op">=</span> <span class="st">"manhattan"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "0 environmental outlier(s) found with methods grubbs and manhattan (distance)."</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotOutliers.html">plotOutliers</a></span><span class="op">(</span><span class="va">e_manhattan</span>, shpToPlot <span class="op">=</span> <span class="va">worldWGS84</span>, legLoc <span class="op">=</span> <span class="st">"topright"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">## all geometries</span></span></code></pre>
<p><img src="occOutlier_files/figure-html/e_man_plot-1.png" width="80%"></p>
</div>
<div class="section level4">
<h4 id="cosine">Cosine<a class="anchor" aria-label="anchor" href="#cosine"></a>
</h4>
<p>The Cosine Dissimilarity measures the similarity between two vectors
by calculating the cosine of the angle between them, resulting in a
value between -1 and 1, where higher values indicate more similar
vectors.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e_cosine</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findOutliers.html">findOutliers</a></span><span class="op">(</span><span class="va">A_scraba</span>, spatial <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                         distEnvMethod <span class="op">=</span> <span class="st">"cosine"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "0 environmental outlier(s) found with methods grubbs and cosine (distance)."</span></span></code></pre>
<p>As the Manhattan distance example, it was not detected an
environmental outlier.</p>
</div>
<div class="section level4">
<h4 id="mahalanobis">Mahalanobis<a class="anchor" aria-label="anchor" href="#mahalanobis"></a>
</h4>
<p>The Mahalanobis distance is a measure of the distance between a point
and a distribution, taking into account the covariance between
variables. It’s used to detect outliers in multivariate data by
calculating how far a point is from the center of the distribution while
accounting for its spread and correlations.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">e_mahalanobis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findOutliers.html">findOutliers</a></span><span class="op">(</span><span class="va">A_scraba</span>, spatial <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                              distEnvMethod <span class="op">=</span> <span class="st">"mahalanobis"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "1 environmental outlier(s) found with methods grubbs and mahalanobis (distance)."</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotOutliers.html">plotOutliers</a></span><span class="op">(</span><span class="va">e_mahalanobis</span>, shpToPlot <span class="op">=</span> <span class="va">worldWGS84</span>, legLoc <span class="op">=</span> <span class="st">"topright"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">## all geometries</span></span></code></pre>
<p><img src="occOutlier_files/figure-html/unnamed-chunk-3-1.png" width="80%"></p>
</div>
</div>
<div class="section level3">
<h3 id="spatial-environmental">Spatial &amp; Environmental<a class="anchor" aria-label="anchor" href="#spatial-environmental"></a>
</h3>
<p>You can also detect both types of outliers in an unique call. Here,
we will use <em>Camissonia_tanacetifolia</em> as an example.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">C_tanacetifolia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/Camissonia_tanacetifolia.csv'</span>,</span>
<span>                                   package <span class="op">=</span> <span class="st">'occOutliers'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Set WGS84</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_set_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">out_C_tana</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findOutliers.html">findOutliers</a></span><span class="op">(</span><span class="va">C_tanacetifolia</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "1 geographic outlier(s) found with method grubbs"</span></span>
<span><span class="co">## [1] "1 environmental outlier(s) found with methods grubbs and euclidean (distance)."</span></span></code></pre>
<p>In this example, it was detected two outliers, one spatial and one
environmental, but they correspond to the same observation.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotOutliers.html">plotOutliers</a></span><span class="op">(</span><span class="va">out_C_tana</span>, shpToPlot <span class="op">=</span> <span class="va">worldWGS84</span>, legLoc <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">## all geometries</span></span></code></pre>
<p><img src="occOutlier_files/figure-html/C_tan_plot-1.png" width="80%"></p>
<p>Changing the p-value to 0.05 (a lower value), you are able to detect
four outliers. One exclusively spatial, one exclusively environmental,
and two other that are outliers in the geography and in the
environment.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out_pval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findOutliers.html">findOutliers</a></span><span class="op">(</span><span class="va">C_tanacetifolia</span>, pval <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "3 geographic outlier(s) found with method grubbs"</span></span>
<span><span class="co">## [1] "3 environmental outlier(s) found with methods grubbs and euclidean (distance)."</span></span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotOutliers.html">plotOutliers</a></span><span class="op">(</span><span class="va">out_pval</span>, shpToPlot <span class="op">=</span> <span class="va">worldWGS84</span>, legLoc <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: attribute variables are assumed to be spatially constant throughout</span></span>
<span><span class="co">## all geometries</span></span></code></pre>
<p><img src="occOutlier_files/figure-html/out_pval-1.png" width="80%"></p>
<!-- In this case, because there are a cluster of presences in North America, using a lower p-value helps to detect them.  -->
<!-- ```{r,fig.width=7, fig.height=7, dpi=300,out.width='80%'} -->
<!-- myPres4=read.csv(system.file('extdata/SpeciesCSVs/Aster_tataricus.csv',package='occOutliers')) -->
<!-- myPres4=myPres4[complete.cases(myPres4),] -->
<!-- sp::coordinates(myPres4)=c(1,2) -->
<!-- myPres4DF=sp::SpatialPointsDataFrame(myPres4,data.frame(raster::extract(myEnv,myPres4))) -->
<!-- presOut4=findOutlyingPoints(pres=myPres4DF, -->
<!--                            spOutliers=TRUE, -->
<!--                            envOutliers=TRUE, -->
<!--                            pval=1e-3) # note the lower value here -->
<!-- plotOutliers(presOut4,shpToPlot = world.shp) -->
<!-- ``` -->
<!-- However, lowering the p-value cannot just be done arbitarily. In this case, the biased sampling in Europe places the geographic centroid there, making the more poorly sampled parts of Asia appear as outliers. Hence some visual inspection should be used to assess results; this issue occurs typically when extreme sampling bias is present. A lower p-value of 1e-6 helps this situation, although it's unclear whether the detected outliers still reflect undersampling. If one suspects that they do, it would be preferrable to spatially thin the presences (e.g., using the `spThin` package) to remove some sampling bias before using outlier detection.  -->
<!-- ```{r,fig.width=6, fig.height=6, dpi=300,out.width='80%'} -->
<!-- myPres5=read.csv(system.file('extdata/SpeciesCSVs/Betula_pendula.csv',package='occOutliers')) -->
<!-- myPres5=myPres5[complete.cases(myPres5),] -->
<!-- sp::coordinates(myPres5)=c(1,2) -->
<!-- myPres5DF=sp::SpatialPointsDataFrame(myPres5,data.frame(raster::extract(myEnv,myPres5))) -->
<!-- presOut5=findOutlyingPoints(pres=myPres5DF, -->
<!--                            spOutliers=TRUE, -->
<!--                            envOutliers=TRUE, -->
<!--                            pval=1e-3) # note the lower value here -->
<!-- plotOutliers(presOut5,shpToPlot = world.shp) -->
<!-- presOut5.1=findOutlyingPoints(pres=myPres5DF, -->
<!--                            spOutliers=TRUE, -->
<!--                            envOutliers=TRUE, -->
<!--                            pval=1e-6) # note the lower value here -->
<!-- plotOutliers(presOut5.1,shpToPlot = world.shp) -->
<!-- ``` -->
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cory Merow, Gonzalo E. Pinilla-Buitrago.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
